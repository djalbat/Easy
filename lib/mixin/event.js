'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function on(eventTypes, handler, intermediateHandler) {
  eventTypes = eventTypes.split(' '); ///

  eventTypes.forEach(function (eventType) {
    onEvent(this, eventType, handler, intermediateHandler);
  }.bind(this));
}

function off(eventTypes, handler) {
  eventTypes = eventTypes.split(' '); ///

  eventTypes.forEach(function (eventType) {
    offEvent(this, eventType, handler);
  }.bind(this));
}

var eventMixin = {
  on: on,
  off: off
};

module.exports = eventMixin;

function onEvent(element, eventType, handler, intermediateHandler) {
  if (!element.hasOwnProperty('eventObjectMap')) {
    var _eventObjectMap = {};

    element.eventObjectMap = _eventObjectMap;
  }

  var eventObjectMap = element.eventObjectMap;

  if (!eventObjectMap.hasOwnProperty(eventType)) {
    var _eventObject = createEventObject();

    eventObjectMap[eventType] = _eventObject;
  }

  var eventObject = eventObjectMap[eventType];

  eventObject.addHandler(element, eventType, handler, intermediateHandler);
}

function offEvent(element, eventType, handler) {
  var eventObject = element.eventObjectMap[eventType],
      noneRemaining = eventObject.removeHandler(element, eventType, handler);

  if (noneRemaining) {
    delete element.eventObjectMap[eventType];
  }

  var eventTypes = Object.keys(element.eventObjectMap);

  if (eventTypes.length === 0) {
    delete element.eventObjectMap;
  }
}

function createEventObject() {
  var eventListeners = [];

  function addHandler(element, eventType, handler, intermediateHandler) {
    var targetElement = element,
        ///
    eventListener = createEventListener(handler, intermediateHandler, targetElement);

    element.domElement.addEventListener(eventType, eventListener);

    eventListeners.push(eventListener);
  }

  function removeHandler(element, eventType) {
    var handler = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

    if (handler === null) {
      eventListeners.forEach(function (eventListener) {
        element.domElement.removeEventListener(eventType, eventListener);
      });

      var start = 0;

      eventListeners.splice(start);
    } else {
      var index = indexOfEventListener(eventListeners, handler),
          eventListener = eventListeners[index];

      element.domElement.removeEventListener(eventType, eventListener);

      var _start = index,
          ///
      deleteCount = 1;

      eventListeners.splice(_start, deleteCount);
    }

    var noneRemaining = eventListeners.length === 0; ///

    return noneRemaining;
  }

  return {
    addHandler: addHandler,
    removeHandler: removeHandler
  };
}

function createEventListener(handler, intermediateHandler, targetElement) {
  if ((typeof intermediateHandler === 'undefined' ? 'undefined' : _typeof(intermediateHandler)) === 'object') {
    var object = intermediateHandler; ///

    intermediateHandler = createBindingIntermediateHandler(object); ///
  }

  var eventListener = function eventListener(event) {
    intermediateHandler !== undefined ? intermediateHandler(handler, event, targetElement) : handler(event, event, targetElement);
  };

  Object.assign(eventListener, {
    handler: handler
  });

  return eventListener;
}

function createBindingIntermediateHandler(object) {
  var bindingIntermediateHandler = function bindingIntermediateHandler(handler, event, targetElement) {
    handler.call(object, event, targetElement);
  };

  return bindingIntermediateHandler;
}

function indexOfEventListener(eventListeners, handler) {
  var foundIndex = undefined; ///

  eventListeners.forEach(function (eventListener, index) {
    if (eventListener.handler === handler) {
      ///
      foundIndex = index;
    }
  });

  var index = foundIndex; ///

  return index;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9taXhpbi9ldmVudC5qcyJdLCJuYW1lcyI6WyJvbiIsImV2ZW50VHlwZXMiLCJoYW5kbGVyIiwiaW50ZXJtZWRpYXRlSGFuZGxlciIsInNwbGl0IiwiZm9yRWFjaCIsImV2ZW50VHlwZSIsIm9uRXZlbnQiLCJiaW5kIiwib2ZmIiwib2ZmRXZlbnQiLCJldmVudE1peGluIiwibW9kdWxlIiwiZXhwb3J0cyIsImVsZW1lbnQiLCJoYXNPd25Qcm9wZXJ0eSIsImV2ZW50T2JqZWN0TWFwIiwiZXZlbnRPYmplY3QiLCJjcmVhdGVFdmVudE9iamVjdCIsImFkZEhhbmRsZXIiLCJub25lUmVtYWluaW5nIiwicmVtb3ZlSGFuZGxlciIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJldmVudExpc3RlbmVycyIsInRhcmdldEVsZW1lbnQiLCJldmVudExpc3RlbmVyIiwiY3JlYXRlRXZlbnRMaXN0ZW5lciIsImRvbUVsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwicHVzaCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzdGFydCIsInNwbGljZSIsImluZGV4IiwiaW5kZXhPZkV2ZW50TGlzdGVuZXIiLCJkZWxldGVDb3VudCIsIm9iamVjdCIsImNyZWF0ZUJpbmRpbmdJbnRlcm1lZGlhdGVIYW5kbGVyIiwiZXZlbnQiLCJ1bmRlZmluZWQiLCJhc3NpZ24iLCJiaW5kaW5nSW50ZXJtZWRpYXRlSGFuZGxlciIsImNhbGwiLCJmb3VuZEluZGV4Il0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQUVBLFNBQVNBLEVBQVQsQ0FBWUMsVUFBWixFQUF3QkMsT0FBeEIsRUFBaUNDLG1CQUFqQyxFQUFzRDtBQUNwREYsZUFBYUEsV0FBV0csS0FBWCxDQUFpQixHQUFqQixDQUFiLENBRG9ELENBQ2hCOztBQUVwQ0gsYUFBV0ksT0FBWCxDQUFtQixVQUFTQyxTQUFULEVBQW9CO0FBQ3JDQyxZQUFRLElBQVIsRUFBY0QsU0FBZCxFQUF5QkosT0FBekIsRUFBa0NDLG1CQUFs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QTBDRCxNQUExQyxFQUFrRDtBQUNoRCxNQUFNSyw2QkFBNkIsU0FBN0JBLDBCQUE2QixDQUFTekMsT0FBVCxFQUFrQnNDLEtBQWxCLEVBQXlCZCxhQUF6QixFQUF3QztBQUN6RXhCLFlBQVEwQyxJQUFSLENBQWFOLE1BQWIsRUFBcUJFLEtBQXJCLEVBQTRCZCxhQUE1QjtBQUNELEdBRkQ7O0FBSUEsU0FBT2lCLDBCQUFQO0FBQ0Q7O0FBRUQsU0FBU1Asb0JBQVQsQ0FBOEJYLGNBQTlCLEVBQThDdkIsT0FBOUMsRUFBdUQ7QUFDckQsTUFBSTJDLGFBQWFKLFNBQWpCLENBRHFELENBQ3pCOztBQUU1QmhCLGlCQUFlcEIsT0FBZixDQUF1QixVQUFTc0IsYUFBVCxFQUF3QlEsS0FBeEIsRUFBK0I7QUFDcEQsUUFBSVIsY0FBY3pCLE9BQWQsS0FBMEJBLE9BQTlCLEVBQXVDO0FBQUc7QUFDeEMyQyxtQkFBYVYsS0FBYjtBQUNEO0FBQ0YsR0FKRDs7QUFNQSxNQUFNQSxRQUFRVSxVQUFkLENBVHFELENBUzNCOztBQUUxQixTQUFPVixLQUFQO0FBQ0QiLCJmaWxlIjoiZXZlbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIG9uKGV2ZW50VHlwZXMsIGhhbmRsZXIsIGludGVybWVkaWF0ZUhhbmRsZXIpIHtcbiAgZXZlbnRUeXBlcyA9IGV2ZW50VHlwZXMuc3BsaXQoJyAnKTsgLy8vXG5cbiAgZXZlbnRUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50VHlwZSkge1xuICAgIG9uRXZlbnQodGhpcywgZXZlbnRUeXBlLCBoYW5kbGVyLCBpbnRlcm1lZGlhdGVIYW5kbGVyKTtcbiAgfS5iaW5kKHRoaXMpKTtcbn1cblxuZnVuY3Rpb24gb2ZmKGV2ZW50VHlwZXMsIGhhbmRsZXIpIHtcbiAgZXZlbnRUeXBlcyA9IGV2ZW50VHlwZXMuc3BsaXQoJyAnKTsgLy8vXG5cbiAgZXZlbnRUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50VHlwZSkge1xuICAgIG9mZkV2ZW50KHRoaXMsIGV2ZW50VHlwZSwgaGFuZGxlcik7XG4gIH0uYmluZCh0aGlzKSk7XG59XG5cbmNvbnN0IGV2ZW50TWl4aW4gPSB7XG4gIG9uOiBvbixcbiAgb2ZmOiBvZmZcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZXZlbnRNaXhpbjtcblxuZnVuY3Rpb24gb25FdmVudChlbGVtZW50LCBldmVudFR5cGUsIGhhbmRsZXIsIGludGVybWVkaWF0ZUhhbmRsZXIpIHtcbiAgaWYgKCFlbGVtZW50Lmhhc093blByb3BlcnR5KCdldmVudE9iamVjdE1hcCcpKSB7XG4gICAgY29uc3QgZXZlbnRPYmplY3RNYXAgPSB7fTtcblxuICAgIGVsZW1lbnQuZXZlbnRPYmplY3RNYXAgPSBldmVudE9iamVjdE1hcDtcbiAgfVxuXG4gIGNvbnN0IGV2ZW50T2JqZWN0TWFwID0gZWxlbWVudC5ldmVudE9iamVjdE1hcDtcblxuICBpZiAoIWV2ZW50T2JqZWN0TWFwLmhhc093blByb3BlcnR5KGV2ZW50VHlwZSkpIHtcbiAgICBjb25zdCBldmVudE9iamVjdCA9IGNyZWF0ZUV2ZW50T2JqZWN0KCk7XG5cbiAgICBldmVudE9iamVjdE1hcFtldmVudFR5cGVdID0gZXZlbnRPYmplY3Q7XG4gIH1cblxuICBjb25zdCBldmVudE9iamVjdCA9IGV2ZW50T2JqZWN0TWFwW2V2ZW50VHlwZV07XG5cbiAgZXZlbnRPYmplY3QuYWRkSGFuZGxlcihlbGVtZW50LCBldmVudFR5cGUsIGhhbmRsZXIsIGludGVybWVkaWF0ZUhhbmRsZXIpO1xufVxuXG5mdW5jdGlvbiBvZmZFdmVudChlbGVtZW50LCBldmVudFR5cGUsIGhhbmRsZXIpIHtcbiAgY29uc3QgZXZlbnRPYmplY3QgPSBlbGVtZW50LmV2ZW50T2JqZWN0TWFwW2V2ZW50VHlwZV0sXG4gICAgICAgIG5vbmVSZW1haW5pbmcgPSBldmVudE9iamVjdC5yZW1vdmVIYW5kbGVyKGVsZW1lbnQsIGV2ZW50VHlwZSwgaGFuZGxlcik7XG5cbiAgaWYgKG5vbmVSZW1haW5pbmcpIHtcbiAgICBkZWxldGUgZWxlbWVudC5ldmVudE9iamVjdE1hcFtldmVudFR5cGVdO1xuICB9XG5cbiAgY29uc3QgZXZlbnRUeXBlcyA9IE9iamVjdC5rZXlzKGVsZW1lbnQuZXZlbnRPYmplY3RNYXApO1xuXG4gIGlmIChldmVudFR5cGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIGRlbGV0ZSBlbGVtZW50LmV2ZW50T2JqZWN0TWFwO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUV2ZW50T2JqZWN0KCkge1xuICBjb25zdCBldmVudExpc3RlbmVycyA9IFtdO1xuXG4gIGZ1bmN0aW9uIGFkZEhhbmRsZXIoZWxlbWVudCwgZXZlbnRUeXBlLCBoYW5kbGVyLCBpbnRlcm1lZGlhdGVIYW5kbGVyKSB7XG4gICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGVsZW1lbnQsICAvLy9cbiAgICAgICAgICBldmVudExpc3RlbmVyID0gY3JlYXRlRXZlbnRMaXN0ZW5lcihoYW5kbGVyLCBpbnRlcm1lZGlhdGVIYW5kbGVyLCB0YXJnZXRFbGVtZW50KTtcblxuICAgIGVsZW1lbnQuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgZXZlbnRMaXN0ZW5lcik7XG5cbiAgICBldmVudExpc3RlbmVycy5wdXNoKGV2ZW50TGlzdGVuZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlSGFuZGxlcihlbGVtZW50LCBldmVudFR5cGUsIGhhbmRsZXIgPSBudWxsKSB7XG4gICAgaWYgKGhhbmRsZXIgPT09IG51bGwpIHtcbiAgICAgIGV2ZW50TGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24oZXZlbnRMaXN0ZW5lcikge1xuICAgICAgICBlbGVtZW50LmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGV2ZW50TGlzdGVuZXIpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHN0YXJ0ID0gMDtcblxuICAgICAgZXZlbnRMaXN0ZW5lcnMuc3BsaWNlKHN0YXJ0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaW5kZXggPSBpbmRleE9mRXZlbnRMaXN0ZW5lcihldmVudExpc3RlbmVycywgaGFuZGxlciksXG4gICAgICAgICAgICBldmVudExpc3RlbmVyID0gZXZlbnRMaXN0ZW5lcnNbaW5kZXhdO1xuXG4gICAgICBlbGVtZW50LmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGV2ZW50TGlzdGVuZXIpO1xuXG4gICAgICBjb25zdCBzdGFydCA9IGluZGV4LCAgLy8vXG4gICAgICAgICAgICBkZWxldGVDb3VudCA9IDE7XG5cbiAgICAgIGV2ZW50TGlzdGVuZXJzLnNwbGljZShzdGFydCwgZGVsZXRlQ291bnQpO1xuICAgIH1cblxuICAgIGNvbnN0IG5vbmVSZW1haW5pbmcgPSAoZXZlbnRMaXN0ZW5lcnMubGVuZ3RoID09PSAwKTsgIC8vL1xuXG4gICAgcmV0dXJuIG5vbmVSZW1haW5pbmc7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZEhhbmRsZXI6IGFkZEhhbmRsZXIsXG4gICAgcmVtb3ZlSGFuZGxlcjogcmVtb3ZlSGFuZGxlclxuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVFdmVudExpc3RlbmVyKGhhbmRsZXIsIGludGVybWVkaWF0ZUhhbmRsZXIsIHRhcmdldEVsZW1lbnQpIHtcbiAgaWYgKHR5cGVvZiBpbnRlcm1lZGlhdGVIYW5kbGVyID09PSAnb2JqZWN0Jykge1xuICAgIGNvbnN0IG9iamVjdCA9IGludGVybWVkaWF0ZUhhbmRsZXI7ICAvLy9cblxuICAgIGludGVybWVkaWF0ZUhhbmRsZXIgPSBjcmVhdGVCaW5kaW5nSW50ZXJtZWRpYXRlSGFuZGxlcihvYmplY3QpOyAvLy9cbiAgfVxuXG4gIGNvbnN0IGV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCkge1xuICAgIChpbnRlcm1lZGlhdGVIYW5kbGVyICE9PSB1bmRlZmluZWQpID9cbiAgICAgIGludGVybWVkaWF0ZUhhbmRsZXIoaGFuZGxlciwgZXZlbnQsIHRhcmdldEVsZW1lbnQpIDpcbiAgICAgICAgaGFuZGxlcihldmVudCwgZXZlbnQsIHRhcmdldEVsZW1lbnQpO1xuICB9O1xuXG4gIE9iamVjdC5hc3NpZ24oZXZlbnRMaXN0ZW5lciwge1xuICAgIGhhbmRsZXI6IGhhbmRsZXJcbiAgfSk7XG5cbiAgcmV0dXJuIGV2ZW50TGlzdGVuZXI7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmdJbnRlcm1lZGlhdGVIYW5kbGVyKG9iamVjdCkge1xuICBjb25zdCBiaW5kaW5nSW50ZXJtZWRpYXRlSGFuZGxlciA9IGZ1bmN0aW9uKGhhbmRsZXIsIGV2ZW50LCB0YXJnZXRFbGVtZW50KSB7XG4gICAgaGFuZGxlci5jYWxsKG9iamVjdCwgZXZlbnQsIHRhcmdldEVsZW1lbnQpO1xuICB9O1xuXG4gIHJldHVybiBiaW5kaW5nSW50ZXJtZWRpYXRlSGFuZGxlcjtcbn1cblxuZnVuY3Rpb24gaW5kZXhPZkV2ZW50TGlzdGVuZXIoZXZlbnRMaXN0ZW5lcnMsIGhhbmRsZXIpIHtcbiAgbGV0IGZvdW5kSW5kZXggPSB1bmRlZmluZWQ7IC8vL1xuXG4gIGV2ZW50TGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24oZXZlbnRMaXN0ZW5lciwgaW5kZXgpIHtcbiAgICBpZiAoZXZlbnRMaXN0ZW5lci5oYW5kbGVyID09PSBoYW5kbGVyKSB7ICAvLy9cbiAgICAgIGZvdW5kSW5kZXggPSBpbmRleDtcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IGluZGV4ID0gZm91bmRJbmRleDsgLy8vXG5cbiAgcmV0dXJuIGluZGV4O1xufVxuIl19