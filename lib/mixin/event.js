'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function on(eventTypes, handler, intermediateHandler) {
  eventTypes = eventTypes.split(' '); ///

  eventTypes.forEach(function (eventType) {
    onEvent(this, eventType, handler, intermediateHandler);
  }.bind(this));
}

function off(eventTypes, handler) {
  eventTypes = eventTypes.split(' '); ///

  eventTypes.forEach(function (eventType) {
    offEvent(this, eventType, handler);
  }.bind(this));
}

var eventMixin = {
  on: on,
  off: off
};

module.exports = eventMixin;

function onEvent(element, eventType, handler, intermediateHandler) {
  if (!element.hasOwnProperty('eventObjectMap')) {
    var eventObjectMap = {};

    Object.assign(element, {
      eventObjectMap: eventObjectMap
    });
  }

  var eventObject = element.eventObjectMap[eventType];

  if (!eventObject) {
    eventObject = createEventObject();

    element.eventObjectMap[eventType] = eventObject;
  }

  eventObject.addHandler(element, eventType, handler, intermediateHandler);
}

function offEvent(element, eventType, handler) {
  var eventObject = element.eventObjectMap[eventType],
      noneRemaining = eventObject.removeHandler(element, eventType, handler);

  if (noneRemaining) {
    delete element.eventObjectMap[eventType];
  }

  var eventTypes = Object.keys(element.eventObjectMap);

  if (eventTypes.length === 0) {
    delete element.eventObjectMap;
  }
}

function createEventObject() {
  var eventListeners = [];

  function addHandler(element, eventType, handler, intermediateHandler) {
    var targetElement = element,
        ///
    eventListener = createEventListener(handler, intermediateHandler, targetElement);

    element.domElement.addEventListener(eventType, eventListener);

    eventListeners.push(eventListener);
  }

  function removeHandler(element, eventType) {
    var handler = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];

    if (handler === null) {
      eventListeners.forEach(function (eventListener) {
        element.domElement.removeEventListener(eventType, eventListener);
      });

      var start = 0;

      eventListeners.splice(start);
    } else {
      var index = indexOfEventListener(eventListeners, handler),
          eventListener = eventListeners[index];

      element.domElement.removeEventListener(eventType, eventListener);

      var _start = index,
          ///
      deleteCount = 1;

      eventListeners.splice(_start, deleteCount);
    }

    var noneRemaining = eventListeners.length === 0; ///

    return noneRemaining;
  }

  return {
    addHandler: addHandler,
    removeHandler: removeHandler
  };
}

function createEventListener(handler, intermediateHandler, targetElement) {
  if ((typeof intermediateHandler === 'undefined' ? 'undefined' : _typeof(intermediateHandler)) === 'object') {
    var object = intermediateHandler; ///

    intermediateHandler = createBindingIntermediateHandler(object); ///
  }

  var eventListener = function eventListener(event) {
    var preventDefault = intermediateHandler !== undefined ? intermediateHandler(handler, event, targetElement) : handler(event, targetElement);

    if (preventDefault === true) {
      event.preventDefault();
    }

    event.stopPropagation();
  };

  Object.assign(eventListener, {
    handler: handler
  });

  return eventListener;
}

function createBindingIntermediateHandler(object) {
  var bindingIntermediateHandler = function bindingIntermediateHandler(handler, event, targetElement) {
    var preventDefault = handler.call(object, event, targetElement);

    return preventDefault;
  };

  return bindingIntermediateHandler;
}

function indexOfEventListener(eventListeners, handler) {
  var foundIndex = undefined; ///

  eventListeners.forEach(function (eventListener, index) {
    if (eventListener.handler === handler) {
      ///
      foundIndex = index;
    }
  });

  var index = foundIndex; ///

  return index;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9taXhpbi9ldmVudC5qcyJdLCJuYW1lcyI6WyJvbiIsImV2ZW50VHlwZXMiLCJoYW5kbGVyIiwiaW50ZXJtZWRpYXRlSGFuZGxlciIsInNwbGl0IiwiZm9yRWFjaCIsImV2ZW50VHlwZSIsIm9uRXZlbnQiLCJiaW5kIiwib2ZmIiwib2ZmRXZlbnQiLCJldmVudE1peGluIiwibW9kdWxlIiwiZXhwb3J0cyIsImVsZW1lbnQiLCJoYXNPd25Qcm9wZXJ0eSIsImV2ZW50T2JqZWN0TWFwIiwiT2JqZWN0IiwiYXNzaWduIiwiZXZlbnRPYmplY3QiLCJjcmVhdGVFdmVudE9iamVjdCIsImFkZEhhbmRsZXIiLCJub25lUmVtYWluaW5nIiwicmVtb3ZlSGFuZGxlciIsImtleXMiLCJsZW5ndGgiLCJldmVudExpc3RlbmVycyIsInRhcmdldEVsZW1lbnQiLCJldmVudExpc3RlbmVyIiwiY3JlYXRlRXZlbnRMaXN0ZW5lciIsImRvbUVsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwicHVzaCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzdGFydCIsInNwbGljZSIsImluZGV4IiwiaW5kZXhPZkV2ZW50TGlzdGVuZXIiLCJkZWxldGVDb3VudCIsIm9iamVjdCIsImNyZWF0ZUJpbmRpbmdJbnRlcm1lZGlhdGVIYW5kbGVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInVuZGVmaW5lZCIsInN0b3BQcm9wYWdhdGlvbiIsImJpbmRpbmdJbnRlcm1lZGlhdGVIYW5kbGVyIiwiY2FsbCIsImZvdW5kSW5kZXgiXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBRUEsU0FBU0EsRUFBVCxDQUFZQyxVQUFaLEVBQXdCQyxPQUF4QixFQUFpQ0MsbUJBQWpDLEVBQXNEO0FBQ3BERixlQUFhQSxXQUFXRyxLQUFYLENBQWlCLEdBQWpCLENBQWIsQ0FEb0QsQ0FDaEI7O0FBRXBDSCxhQUFXSSxPQUFYLENBQW1CLFVBQVNDLFNBQVQsRUFBb0I7QUFDckNDLFlBQVEsSUFBUixF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RDs7QUFZQTNCLFNBQU9DLE1BQVAsQ0FBY1UsYUFBZCxFQUE2QjtBQUMzQjFCLGFBQVNBO0FBRGtCLEdBQTdCOztBQUlBLFNBQU8wQixhQUFQO0FBQ0Q7O0FBRUQsU0FBU1ksZ0NBQVQsQ0FBMENELE1BQTFDLEVBQWtEO0FBQ2hELE1BQU1NLDZCQUE2QixTQUE3QkEsMEJBQTZCLENBQVMzQyxPQUFULEVBQWtCdUMsS0FBbEIsRUFBeUJkLGFBQXpCLEVBQXdDO0FBQ3pFLFFBQU1lLGlCQUFpQnhDLFFBQVE0QyxJQUFSLENBQWFQLE1BQWIsRUFBcUJFLEtBQXJCLEVBQTRCZCxhQUE1QixDQUF2Qjs7QUFFQSxXQUFPZSxjQUFQO0FBQ0QsR0FKRDs7QUFNQSxTQUFPRywwQkFBUDtBQUNEOztBQUVELFNBQVNSLG9CQUFULENBQThCWCxjQUE5QixFQUE4Q3hCLE9BQTlDLEVBQXVEO0FBQ3JELE1BQUk2QyxhQUFhSixTQUFqQixDQURxRCxDQUN6Qjs7QUFFNUJqQixpQkFBZXJCLE9BQWYsQ0FBdUIsVUFBU3VCLGFBQVQsRUFBd0JRLEtBQXhCLEVBQStCO0FBQ3BELFFBQUlSLGNBQWMxQixPQUFkLEtBQTBCQSxPQUE5QixFQUF1QztBQUFHO0FBQ3hDNkMsbUJBQWFYLEtBQWI7QUFDRDtBQUNGLEdBSkQ7O0FBTUEsTUFBTUEsUUFBUVcsVUFBZCxDQVRxRCxDQVMzQjs7QUFFMUIsU0FBT1gsS0FBUDtBQUNEIiwiZmlsZSI6ImV2ZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBvbihldmVudFR5cGVzLCBoYW5kbGVyLCBpbnRlcm1lZGlhdGVIYW5kbGVyKSB7XG4gIGV2ZW50VHlwZXMgPSBldmVudFR5cGVzLnNwbGl0KCcgJyk7IC8vL1xuXG4gIGV2ZW50VHlwZXMuZm9yRWFjaChmdW5jdGlvbihldmVudFR5cGUpIHtcbiAgICBvbkV2ZW50KHRoaXMsIGV2ZW50VHlwZSwgaGFuZGxlciwgaW50ZXJtZWRpYXRlSGFuZGxlcik7XG4gIH0uYmluZCh0aGlzKSk7XG59XG5cbmZ1bmN0aW9uIG9mZihldmVudFR5cGVzLCBoYW5kbGVyKSB7XG4gIGV2ZW50VHlwZXMgPSBldmVudFR5cGVzLnNwbGl0KCcgJyk7IC8vL1xuXG4gIGV2ZW50VHlwZXMuZm9yRWFjaChmdW5jdGlvbihldmVudFR5cGUpIHtcbiAgICBvZmZFdmVudCh0aGlzLCBldmVudFR5cGUsIGhhbmRsZXIpO1xuICB9LmJpbmQodGhpcykpO1xufVxuXG5jb25zdCBldmVudE1peGluID0ge1xuICBvbjogb24sXG4gIG9mZjogb2ZmXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGV2ZW50TWl4aW47XG5cbmZ1bmN0aW9uIG9uRXZlbnQoZWxlbWVudCwgZXZlbnRUeXBlLCBoYW5kbGVyLCBpbnRlcm1lZGlhdGVIYW5kbGVyKSB7XG4gIGlmICghZWxlbWVudC5oYXNPd25Qcm9wZXJ0eSgnZXZlbnRPYmplY3RNYXAnKSkge1xuICAgIGNvbnN0IGV2ZW50T2JqZWN0TWFwID0ge307XG5cbiAgICBPYmplY3QuYXNzaWduKGVsZW1lbnQsIHtcbiAgICAgIGV2ZW50T2JqZWN0TWFwOiBldmVudE9iamVjdE1hcFxuICAgIH0pO1xuICB9XG5cbiAgbGV0IGV2ZW50T2JqZWN0ID0gZWxlbWVudC5ldmVudE9iamVjdE1hcFtldmVudFR5cGVdO1xuXG4gIGlmICghZXZlbnRPYmplY3QpIHtcbiAgICBldmVudE9iamVjdCA9IGNyZWF0ZUV2ZW50T2JqZWN0KCk7XG5cbiAgICBlbGVtZW50LmV2ZW50T2JqZWN0TWFwW2V2ZW50VHlwZV0gPSBldmVudE9iamVjdDtcbiAgfVxuXG4gIGV2ZW50T2JqZWN0LmFkZEhhbmRsZXIoZWxlbWVudCwgZXZlbnRUeXBlLCBoYW5kbGVyLCBpbnRlcm1lZGlhdGVIYW5kbGVyKTtcbn1cblxuZnVuY3Rpb24gb2ZmRXZlbnQoZWxlbWVudCwgZXZlbnRUeXBlLCBoYW5kbGVyKSB7XG4gIGNvbnN0IGV2ZW50T2JqZWN0ID0gZWxlbWVudC5ldmVudE9iamVjdE1hcFtldmVudFR5cGVdLFxuICAgICAgICBub25lUmVtYWluaW5nID0gZXZlbnRPYmplY3QucmVtb3ZlSGFuZGxlcihlbGVtZW50LCBldmVudFR5cGUsIGhhbmRsZXIpO1xuXG4gIGlmIChub25lUmVtYWluaW5nKSB7XG4gICAgZGVsZXRlIGVsZW1lbnQuZXZlbnRPYmplY3RNYXBbZXZlbnRUeXBlXTtcbiAgfVxuXG4gIGNvbnN0IGV2ZW50VHlwZXMgPSBPYmplY3Qua2V5cyhlbGVtZW50LmV2ZW50T2JqZWN0TWFwKTtcblxuICBpZiAoZXZlbnRUeXBlcy5sZW5ndGggPT09IDApIHtcbiAgICBkZWxldGUgZWxlbWVudC5ldmVudE9iamVjdE1hcDtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVFdmVudE9iamVjdCgpIHtcbiAgY29uc3QgZXZlbnRMaXN0ZW5lcnMgPSBbXTtcblxuICBmdW5jdGlvbiBhZGRIYW5kbGVyKGVsZW1lbnQsIGV2ZW50VHlwZSwgaGFuZGxlciwgaW50ZXJtZWRpYXRlSGFuZGxlcikge1xuICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSBlbGVtZW50LCAgLy8vXG4gICAgICAgICAgZXZlbnRMaXN0ZW5lciA9IGNyZWF0ZUV2ZW50TGlzdGVuZXIoaGFuZGxlciwgaW50ZXJtZWRpYXRlSGFuZGxlciwgdGFyZ2V0RWxlbWVudCk7XG5cbiAgICBlbGVtZW50LmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGV2ZW50TGlzdGVuZXIpO1xuXG4gICAgZXZlbnRMaXN0ZW5lcnMucHVzaChldmVudExpc3RlbmVyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUhhbmRsZXIoZWxlbWVudCwgZXZlbnRUeXBlLCBoYW5kbGVyID0gbnVsbCkge1xuICAgIGlmIChoYW5kbGVyID09PSBudWxsKSB7XG4gICAgICBldmVudExpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgZWxlbWVudC5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBldmVudExpc3RlbmVyKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzdGFydCA9IDA7XG5cbiAgICAgIGV2ZW50TGlzdGVuZXJzLnNwbGljZShzdGFydCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gaW5kZXhPZkV2ZW50TGlzdGVuZXIoZXZlbnRMaXN0ZW5lcnMsIGhhbmRsZXIpLFxuICAgICAgICAgICAgZXZlbnRMaXN0ZW5lciA9IGV2ZW50TGlzdGVuZXJzW2luZGV4XTtcblxuICAgICAgZWxlbWVudC5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBldmVudExpc3RlbmVyKTtcblxuICAgICAgY29uc3Qgc3RhcnQgPSBpbmRleCwgIC8vL1xuICAgICAgICAgICAgZGVsZXRlQ291bnQgPSAxO1xuXG4gICAgICBldmVudExpc3RlbmVycy5zcGxpY2Uoc3RhcnQsIGRlbGV0ZUNvdW50KTtcbiAgICB9XG5cbiAgICBjb25zdCBub25lUmVtYWluaW5nID0gKGV2ZW50TGlzdGVuZXJzLmxlbmd0aCA9PT0gMCk7ICAvLy9cblxuICAgIHJldHVybiBub25lUmVtYWluaW5nO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhZGRIYW5kbGVyOiBhZGRIYW5kbGVyLFxuICAgIHJlbW92ZUhhbmRsZXI6IHJlbW92ZUhhbmRsZXJcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRXZlbnRMaXN0ZW5lcihoYW5kbGVyLCBpbnRlcm1lZGlhdGVIYW5kbGVyLCB0YXJnZXRFbGVtZW50KSB7XG4gIGlmICh0eXBlb2YgaW50ZXJtZWRpYXRlSGFuZGxlciA9PT0gJ29iamVjdCcpIHtcbiAgICBjb25zdCBvYmplY3QgPSBpbnRlcm1lZGlhdGVIYW5kbGVyOyAgLy8vXG5cbiAgICBpbnRlcm1lZGlhdGVIYW5kbGVyID0gY3JlYXRlQmluZGluZ0ludGVybWVkaWF0ZUhhbmRsZXIob2JqZWN0KTsgLy8vXG4gIH1cblxuICBjb25zdCBldmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBjb25zdCBwcmV2ZW50RGVmYXVsdCA9IChpbnRlcm1lZGlhdGVIYW5kbGVyICE9PSB1bmRlZmluZWQpID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVybWVkaWF0ZUhhbmRsZXIoaGFuZGxlciwgZXZlbnQsIHRhcmdldEVsZW1lbnQpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcihldmVudCwgdGFyZ2V0RWxlbWVudCk7XG5cbiAgICBpZiAocHJldmVudERlZmF1bHQgPT09IHRydWUpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH07XG5cbiAgT2JqZWN0LmFzc2lnbihldmVudExpc3RlbmVyLCB7XG4gICAgaGFuZGxlcjogaGFuZGxlclxuICB9KTtcblxuICByZXR1cm4gZXZlbnRMaXN0ZW5lcjtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQmluZGluZ0ludGVybWVkaWF0ZUhhbmRsZXIob2JqZWN0KSB7XG4gIGNvbnN0IGJpbmRpbmdJbnRlcm1lZGlhdGVIYW5kbGVyID0gZnVuY3Rpb24oaGFuZGxlciwgZXZlbnQsIHRhcmdldEVsZW1lbnQpIHtcbiAgICBjb25zdCBwcmV2ZW50RGVmYXVsdCA9IGhhbmRsZXIuY2FsbChvYmplY3QsIGV2ZW50LCB0YXJnZXRFbGVtZW50KTtcblxuICAgIHJldHVybiBwcmV2ZW50RGVmYXVsdDtcbiAgfTtcblxuICByZXR1cm4gYmluZGluZ0ludGVybWVkaWF0ZUhhbmRsZXI7XG59XG5cbmZ1bmN0aW9uIGluZGV4T2ZFdmVudExpc3RlbmVyKGV2ZW50TGlzdGVuZXJzLCBoYW5kbGVyKSB7XG4gIGxldCBmb3VuZEluZGV4ID0gdW5kZWZpbmVkOyAvLy9cblxuICBldmVudExpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50TGlzdGVuZXIsIGluZGV4KSB7XG4gICAgaWYgKGV2ZW50TGlzdGVuZXIuaGFuZGxlciA9PT0gaGFuZGxlcikgeyAgLy8vXG4gICAgICBmb3VuZEluZGV4ID0gaW5kZXg7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBpbmRleCA9IGZvdW5kSW5kZXg7IC8vL1xuXG4gIHJldHVybiBpbmRleDtcbn1cbiJdfQ==