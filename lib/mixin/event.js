'use strict';

function on(eventTypes, handler) {
  eventTypes = eventTypes.split(' '); ///

  eventTypes.forEach(function (eventType) {
    onEvent(this, eventType, handler);
  }.bind(this));
}

function off(eventTypes, handler) {
  eventTypes = eventTypes.split(' '); ///

  eventTypes.forEach(function (eventType) {
    offEvent(this, eventType, handler);
  }.bind(this));
}

var eventMixin = {
  on: on,
  off: off
};

module.exports = eventMixin;

function onEvent(element, eventType, handler) {
  if (element.eventObjectMap === undefined) {
    element.eventObjectMap = {};
  }

  var eventObject = element.eventObjectMap[eventType];

  if (!eventObject) {
    eventObject = createEventObject();

    eventObject.addEventListener(element, eventType);

    element.eventObjectMap[eventType] = eventObject;
  }

  eventObject.addHandler(handler);
}

function offEvent(element, eventType, handler) {
  var eventObject = element.eventObjectMap[eventType];

  var empty = eventObject.removeHandler(handler);

  if (empty) {
    eventObject.removeEventListener(element, eventType);

    delete element.eventObjectMap[eventType];
  }

  var eventTypes = Object.keys(element.eventObjectMap);

  if (eventTypes.length === 0) {
    delete element.eventObjectMap;
  }
}

function createEventObject() {
  var handlers = [];

  function eventListener(event) {
    var eventTarget = event.target,
        targetElement = eventTarget.__element__; ///

    var preventEventDefault = false;

    handlers.forEach(function (handler) {
      if (handler.intermediateHandler !== undefined) {
        var preventDefault = handler.intermediateHandler(handler, event, targetElement);

        if (preventDefault === true) {
          preventEventDefault = true;
        }
      } else {
        var _preventDefault = handler(event, targetElement);

        if (_preventDefault === true) {
          preventEventDefault = true;
        }
      }
    });

    if (preventEventDefault) {
      event.preventDefault();
    }

    event.stopPropagation();
  }

  function addHandler(handler) {
    handlers.push(handler);
  }

  function removeHandler() {
    var handler = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

    if (handler === null) {
      var start = 0;

      handlers.splice(start);
    } else {
      var index = handlers.indexOf(handler);

      if (index > -1) {
        var _start = index,
            ///
        deleteCount = 1;

        handlers.splice(_start, deleteCount);
      }
    }

    var empty = handlers.length === 0;

    return empty;
  }

  function addEventListener(element, eventType) {
    element.domElement.addEventListener(eventType, eventListener);
  }

  function removeEventListener(element, eventType) {
    element.domElement.removeEventListener(eventType, eventListener);
  }

  return {
    addHandler: addHandler,
    removeHandler: removeHandler,
    addEventListener: addEventListener,
    removeEventListener: removeEventListener
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9taXhpbi9ldmVudC5qcyJdLCJuYW1lcyI6WyJvbiIsImV2ZW50VHlwZXMiLCJoYW5kbGVyIiwic3BsaXQiLCJmb3JFYWNoIiwiZXZlbnRUeXBlIiwib25FdmVudCIsImJpbmQiLCJvZmYiLCJvZmZFdmVudCIsImV2ZW50TWl4aW4iLCJtb2R1bGUiLCJleHBvcnRzIiwiZWxlbWVudCIsImV2ZW50T2JqZWN0TWFwIiwidW5kZWZpbmVkIiwiZXZlbnRPYmplY3QiLCJjcmVhdGVFdmVudE9iamVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhZGRIYW5kbGVyIiwiZW1wdHkiLCJyZW1vdmVIYW5kbGVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJoYW5kbGVycyIsImV2ZW50TGlzdGVuZXIiLCJldmVudCIsImV2ZW50VGFyZ2V0IiwidGFyZ2V0IiwidGFyZ2V0RWxlbWVudCIsIl9fZWxlbWVudF9fIiwicHJldmVudEV2ZW50RGVmYXVsdCIsImludGVybWVkaWF0ZUhhbmRsZXIiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsInB1c2giLCJzdGFydCIsInNwbGljZSIsImluZGV4IiwiaW5kZXhPZiIsImRlbGV0ZUNvdW50IiwiZG9tRWxlbWVudCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsU0FBU0EsRUFBVCxDQUFZQyxVQUFaLEVBQXdCQyxPQUF4QixFQUFpQztBQUMvQkQsZUFBYUEsV0FBV0UsS0FBWCxDQUFpQixHQUFqQixDQUFiLENBRCtCLENBQ0s7O0FBRXBDRixhQUFXRyxPQUFYLENBQW1CLFVBQVNDLFNBQVQsRUFBb0I7QUFDckNDLFlBQVEsSUFBUixFQUFjRCxTQUFkLEVBQXlCSCxPQUF6QjtBQUNELEdBRmtCLENBRWpCSyxJQUZpQixDQUVaLElBRlksQ0FBbkI7QUFHRDs7QUFFRCxTQUFTQyxHQUFULENBQWFQLFVBQWIsRUFBeUJDLE9BQXpCLEVBQWtDO0FBQ2hDRCxlQUFh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Q3BCLFVBQU1vQyxRQUFRLENBQWQ7O0FBRUFaLGVBQVNhLE1BQVQsQ0FBZ0JELEtBQWhCO0FBQ0QsS0FKRCxNQUlPO0FBQ0wsVUFBTUUsUUFBUWQsU0FBU2UsT0FBVCxDQUFpQnZDLE9BQWpCLENBQWQ7O0FBRUEsVUFBSXNDLFFBQVEsQ0FBQyxDQUFiLEVBQWdCO0FBQ2QsWUFBTUYsU0FBUUUsS0FBZDtBQUFBLFlBQXNCO0FBQ2hCRSxzQkFBYyxDQURwQjs7QUFHQWhCLGlCQUFTYSxNQUFULENBQWdCRCxNQUFoQixFQUF1QkksV0FBdkI7QUFDRDtBQUNGOztBQUVELFFBQU10QixRQUFTTSxTQUFTRCxNQUFULEtBQW9CLENBQW5DOztBQUVBLFdBQU9MLEtBQVA7QUFDRDs7QUFFRCxXQUFTRixnQkFBVCxDQUEwQkwsT0FBMUIsRUFBbUNSLFNBQW5DLEVBQThDO0FBQzVDUSxZQUFROEIsVUFBUixDQUFtQnpCLGdCQUFuQixDQUFvQ2IsU0FBcEMsRUFBK0NzQixhQUEvQztBQUNEOztBQUVELFdBQVNMLG1CQUFULENBQTZCVCxPQUE3QixFQUFzQ1IsU0FBdEMsRUFBaUQ7QUFDL0NRLFlBQVE4QixVQUFSLENBQW1CckIsbUJBQW5CLENBQXVDakIsU0FBdkMsRUFBa0RzQixhQUFsRDtBQUNEOztBQUVELFNBQU87QUFDTFIsZ0JBQVlBLFVBRFA7QUFFTEUsbUJBQWVBLGFBRlY7QUFHTEgsc0JBQWtCQSxnQkFIYjtBQUlMSSx5QkFBcUJBO0FBSmhCLEdBQVA7QUFNRCIsImZpbGUiOiJldmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gb24oZXZlbnRUeXBlcywgaGFuZGxlcikge1xuICBldmVudFR5cGVzID0gZXZlbnRUeXBlcy5zcGxpdCgnICcpOyAvLy9cblxuICBldmVudFR5cGVzLmZvckVhY2goZnVuY3Rpb24oZXZlbnRUeXBlKSB7XG4gICAgb25FdmVudCh0aGlzLCBldmVudFR5cGUsIGhhbmRsZXIpO1xuICB9LmJpbmQodGhpcykpO1xufVxuXG5mdW5jdGlvbiBvZmYoZXZlbnRUeXBlcywgaGFuZGxlcikge1xuICBldmVudFR5cGVzID0gZXZlbnRUeXBlcy5zcGxpdCgnICcpOyAvLy9cblxuICBldmVudFR5cGVzLmZvckVhY2goZnVuY3Rpb24oZXZlbnRUeXBlKSB7XG4gICAgb2ZmRXZlbnQodGhpcywgZXZlbnRUeXBlLCBoYW5kbGVyKTtcbiAgfS5iaW5kKHRoaXMpKTtcbn1cblxuY29uc3QgZXZlbnRNaXhpbiA9IHtcbiAgb246IG9uLFxuICBvZmY6IG9mZlxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBldmVudE1peGluO1xuXG5mdW5jdGlvbiBvbkV2ZW50KGVsZW1lbnQsIGV2ZW50VHlwZSwgaGFuZGxlcikge1xuICBpZiAoZWxlbWVudC5ldmVudE9iamVjdE1hcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZWxlbWVudC5ldmVudE9iamVjdE1hcCA9IHt9O1xuXG4gIH1cblxuICBsZXQgZXZlbnRPYmplY3QgPSBlbGVtZW50LmV2ZW50T2JqZWN0TWFwW2V2ZW50VHlwZV07XG5cbiAgaWYgKCFldmVudE9iamVjdCkge1xuICAgIGV2ZW50T2JqZWN0ID0gY3JlYXRlRXZlbnRPYmplY3QoKTtcblxuICAgIGV2ZW50T2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoZWxlbWVudCwgZXZlbnRUeXBlKTtcblxuICAgIGVsZW1lbnQuZXZlbnRPYmplY3RNYXBbZXZlbnRUeXBlXSA9IGV2ZW50T2JqZWN0O1xuICB9XG5cbiAgZXZlbnRPYmplY3QuYWRkSGFuZGxlcihoYW5kbGVyKTtcbn1cblxuZnVuY3Rpb24gb2ZmRXZlbnQoZWxlbWVudCwgZXZlbnRUeXBlLCBoYW5kbGVyKSB7XG4gIGNvbnN0IGV2ZW50T2JqZWN0ID0gZWxlbWVudC5ldmVudE9iamVjdE1hcFtldmVudFR5cGVdO1xuXG4gIGNvbnN0IGVtcHR5ID0gZXZlbnRPYmplY3QucmVtb3ZlSGFuZGxlcihoYW5kbGVyKTtcblxuICBpZiAoZW1wdHkpIHtcbiAgICBldmVudE9iamVjdC5yZW1vdmVFdmVudExpc3RlbmVyKGVsZW1lbnQsIGV2ZW50VHlwZSk7XG5cbiAgICBkZWxldGUgZWxlbWVudC5ldmVudE9iamVjdE1hcFtldmVudFR5cGVdO1xuICB9XG5cbiAgY29uc3QgZXZlbnRUeXBlcyA9IE9iamVjdC5rZXlzKGVsZW1lbnQuZXZlbnRPYmplY3RNYXApO1xuXG4gIGlmIChldmVudFR5cGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIGRlbGV0ZSBlbGVtZW50LmV2ZW50T2JqZWN0TWFwO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUV2ZW50T2JqZWN0KCkge1xuICBjb25zdCBoYW5kbGVycyA9IFtdO1xuXG4gIGZ1bmN0aW9uIGV2ZW50TGlzdGVuZXIoZXZlbnQpIHtcbiAgICBjb25zdCBldmVudFRhcmdldCA9IGV2ZW50LnRhcmdldCxcbiAgICAgICAgICB0YXJnZXRFbGVtZW50ID0gZXZlbnRUYXJnZXQuX19lbGVtZW50X187ICAvLy9cblxuICAgIGxldCBwcmV2ZW50RXZlbnREZWZhdWx0ID0gZmFsc2U7XG5cbiAgICBoYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uKGhhbmRsZXIpIHtcbiAgICAgIGlmIChoYW5kbGVyLmludGVybWVkaWF0ZUhhbmRsZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCBwcmV2ZW50RGVmYXVsdCA9IGhhbmRsZXIuaW50ZXJtZWRpYXRlSGFuZGxlcihoYW5kbGVyLCBldmVudCwgdGFyZ2V0RWxlbWVudCk7XG5cbiAgICAgICAgaWYgKHByZXZlbnREZWZhdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgcHJldmVudEV2ZW50RGVmYXVsdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHByZXZlbnREZWZhdWx0ID0gaGFuZGxlcihldmVudCwgdGFyZ2V0RWxlbWVudCk7XG5cbiAgICAgICAgaWYgKHByZXZlbnREZWZhdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgcHJldmVudEV2ZW50RGVmYXVsdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChwcmV2ZW50RXZlbnREZWZhdWx0KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkSGFuZGxlcihoYW5kbGVyKSB7XG4gICAgaGFuZGxlcnMucHVzaChoYW5kbGVyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUhhbmRsZXIoaGFuZGxlciA9IG51bGwpIHtcbiAgICBpZiAoaGFuZGxlciA9PT0gbnVsbCkge1xuICAgICAgY29uc3Qgc3RhcnQgPSAwO1xuXG4gICAgICBoYW5kbGVycy5zcGxpY2Uoc3RhcnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpbmRleCA9IGhhbmRsZXJzLmluZGV4T2YoaGFuZGxlcik7XG5cbiAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gaW5kZXgsICAvLy9cbiAgICAgICAgICAgICAgZGVsZXRlQ291bnQgPSAxO1xuXG4gICAgICAgIGhhbmRsZXJzLnNwbGljZShzdGFydCwgZGVsZXRlQ291bnQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGVtcHR5ID0gKGhhbmRsZXJzLmxlbmd0aCA9PT0gMCk7XG5cbiAgICByZXR1cm4gZW1wdHk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKGVsZW1lbnQsIGV2ZW50VHlwZSkge1xuICAgIGVsZW1lbnQuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgZXZlbnRMaXN0ZW5lcik7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKGVsZW1lbnQsIGV2ZW50VHlwZSkge1xuICAgIGVsZW1lbnQuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgZXZlbnRMaXN0ZW5lcik7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZEhhbmRsZXI6IGFkZEhhbmRsZXIsXG4gICAgcmVtb3ZlSGFuZGxlcjogcmVtb3ZlSGFuZGxlcixcbiAgICBhZGRFdmVudExpc3RlbmVyOiBhZGRFdmVudExpc3RlbmVyLFxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IHJlbW92ZUV2ZW50TGlzdGVuZXJcbiAgfTtcbn1cbiJdfQ==