"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.applyProperties = applyProperties;
exports.getProperties = getProperties;
exports.getContext = getContext;
exports.assignContext = assignContext;

var _object = require("../utilities/object");

var _array = require("../utilities/array");

var _constants = require("../constants");

var _name = require("../utilities/name");

var _elements = require("../utilities/elements");

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function applyProperties(properties, defaultProperties, ignoredProperties) {
  var _this = this;

  properties = Object.assign({}, properties); ///

  (0, _object.combine)(properties, defaultProperties);
  var childElements = childElementsFromElementAndProperties(this, properties) || properties.childElements; ///

  (0, _object.prune)(properties, ignoredProperties);
  var svg = this.domElement.namespaceURI === _constants.SVG_NAMESPACE_URI,
      ///
  names = Object.keys(properties); ///

  names.forEach(function (name) {
    var value = properties[name];

    if (false) {///
    } else if (isHandlerName(name)) {
      addHandler(_this, name, value);
    } else if (isAttributeName(name, svg)) {
      addAttribute(_this, name, value);
    } else {
      if (!_this.hasOwnProperty("properties")) {
        var _properties = {};
        Object.assign(_this, {
          properties: _properties
        });
      }

      _this.properties[name] = value;
    }
  });
  var context = {};
  childElements.forEach(function (childElement) {
    updateContext(childElement, context);
    childElement.addTo(_this);
  });
  Object.assign(this, {
    context: context
  });
}

function getProperties() {
  return this.properties;
}

function getContext() {
  return this.context;
}

function assignContext(names, thenDelete) {
  var _this2 = this;

  var argumentsLength = arguments.length;

  if (argumentsLength === 1) {
    var firstArgument = (0, _array.first)(arguments);

    if (typeof firstArgument === "boolean") {
      names = Object.keys(this.context);
      thenDelete = firstArgument;
    } else {
      thenDelete = true;
    }
  }

  if (argumentsLength === 0) {
    names = Object.keys(this.context);
    thenDelete = true;
  }

  names.forEach(function (name) {
    var value = _this2.context[name],
        propertyName = name,
        ///
    descriptor = {
      value: value
    };
    Object.defineProperty(_this2, propertyName, descriptor);

    if (thenDelete) {
      delete _this2.context[name];
    }
  }, []);
}

function childElementsFromElementAndProperties(element, properties) {
  var childElements = null;

  if (typeof element.childElements === "function") {
    childElements = element.childElements(properties);
    childElements = (0, _array.guarantee)(childElements);
    childElements = (0, _elements.removeFalseyElements)(childElements);
    childElements = (0, _elements.replaceStringsWithTextElements)(childElements);
  }

  return childElements;
}

function updateContext(childElement, context) {
  var parentContext = typeof childElement.parentContext === "function" ? childElement.parentContext() : childElement.context; ///

  Object.assign(context, parentContext);
  delete childElement.context;
}

function addHandler(element, name, value) {
  var eventType = name.substr(2).toLowerCase(),
      ///
  handler = value; ///

  element.on(eventType, handler);
}

function addAttribute(element, name, value) {
  if (name === "className") {
    name = "class";
  }

  if (name === "htmlFor") {
    name = "for";
  }

  if (_typeof(value) === "object") {
    var keys = Object.keys(value);
    keys.forEach(function (key) {
      element.domElement[name][key] = value[key];
    });
  } else if (typeof value === "boolean") {
    if (value) {
      value = name; ///

      element.addAttribute(name, value);
    }
  } else {
    element.addAttribute(name, value);
  }
}

function isHandlerName(name) {
  return name.match(/^on/);
}

function isAttributeName(name, svg) {
  return svg ? (0, _name.isSVGAttributeName)(name) : (0, _name.isHTMLAttributeName)(name);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzeC5qcyJdLCJuYW1lcyI6WyJhcHBseVByb3BlcnRpZXMiLCJwcm9wZXJ0aWVzIiwiZGVmYXVsdFByb3BlcnRpZXMiLCJpZ25vcmVkUHJvcGVydGllcyIsIk9iamVjdCIsImFzc2lnbiIsImNoaWxkRWxlbWVudHMiLCJjaGlsZEVsZW1lbnRzRnJvbUVsZW1lbnRBbmRQcm9wZXJ0aWVzIiwic3ZnIiwiZG9tRWxlbWVudCIsIm5hbWVzcGFjZVVSSSIsIlNWR19OQU1FU1BBQ0VfVVJJIiwibmFtZXMiLCJrZXlzIiwiZm9yRWFjaCIsIm5hbWUiLCJ2YWx1ZSIsImlzSGFuZGxlck5hbWUiLCJhZGRIYW5kbGVyIiwiaXNBdHRyaWJ1dGVOYW1lIiwiYWRkQXR0cmlidXRlIiwiaGFzT3duUHJvcGVydHkiLCJjb250ZXh0IiwiY2hpbGRFbGVtZW50IiwidXBkYXRlQ29udGV4dCIsImFkZFRvIiwiZ2V0UHJvcGVydGllcyIsImdldENvbnRleHQiLCJhc3NpZ25Db250ZXh0IiwidGhlbkRlbGV0ZSIsImFyZ3VtZW50c0xlbmd0aCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZpcnN0QXJndW1lbnQiLCJwcm9wZXJ0eU5hbWUiLCJkZXNjcmlwdG9yIiwiZGVmaW5lUHJvcGVydHkiLCJlbGVtZW50IiwicGFyZW50Q29udGV4dCIsImV2ZW50VHlwZSIsInN1YnN0ciIsInRvTG93ZXJDYXNlIiwiaGFuZGxlciIsIm9uIiwia2V5IiwibWF0Y2giXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFTyxTQUFTQSxlQUFULENBQXlCQyxVQUF6QixFQUFxQ0MsaUJBQXJDLEVBQXdEQyxpQkFBeEQsRUFBMkU7QUFBQTs7QUFDaEZGLEVBQUFBLFVBQVUsR0FBR0csTUFBTSxDQUFDQyxNQUFQLENBQWMsRUFBZCxFQUFrQkosVUFBbEIsQ0FBYixDQURnRixDQUNwQzs7QUFFNUMsdUJBQVFBLFVBQVIsRUFBb0JDLGlCQUFwQjtB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M0I7QUFDRDtBQUNGOztBQUVELFNBQVNDLGFBQVQsQ0FBdUJGLElBQXZCLEVBQTZCO0FBQzNCLFNBQU9BLElBQUksQ0FBQzhCLEtBQUwsQ0FBVyxLQUFYLENBQVA7QUFDRDs7QUFFRCxTQUFTMUIsZUFBVCxDQUF5QkosSUFBekIsRUFBK0JQLEdBQS9CLEVBQW9DO0FBQ2xDLFNBQU9BLEdBQUcsR0FBRyw4QkFBbUJPLElBQW5CLENBQUgsR0FBOEIsK0JBQW9CQSxJQUFwQixDQUF4QztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGNvbWJpbmUsIHBydW5lIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9vYmplY3RcIjtcbmltcG9ydCB7IGZpcnN0LCBndWFyYW50ZWUgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL2FycmF5XCI7XG5pbXBvcnQgeyBTVkdfTkFNRVNQQUNFX1VSSSB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IGlzSFRNTEF0dHJpYnV0ZU5hbWUsIGlzU1ZHQXR0cmlidXRlTmFtZSB9IGZyb20gXCIuLi91dGlsaXRpZXMvbmFtZVwiO1xuaW1wb3J0IHsgcmVtb3ZlRmFsc2V5RWxlbWVudHMsIHJlcGxhY2VTdHJpbmdzV2l0aFRleHRFbGVtZW50cyB9IGZyb20gXCIuLi91dGlsaXRpZXMvZWxlbWVudHNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5UHJvcGVydGllcyhwcm9wZXJ0aWVzLCBkZWZhdWx0UHJvcGVydGllcywgaWdub3JlZFByb3BlcnRpZXMpIHtcbiAgcHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oe30sIHByb3BlcnRpZXMpOyAvLy9cblxuICBjb21iaW5lKHByb3BlcnRpZXMsIGRlZmF1bHRQcm9wZXJ0aWVzKTtcblxuICBjb25zdCBjaGlsZEVsZW1lbnRzID0gY2hpbGRFbGVtZW50c0Zyb21FbGVtZW50QW5kUHJvcGVydGllcyh0aGlzLCBwcm9wZXJ0aWVzKSB8fCBwcm9wZXJ0aWVzLmNoaWxkRWxlbWVudHM7ICAvLy9cblxuICBwcnVuZShwcm9wZXJ0aWVzLCBpZ25vcmVkUHJvcGVydGllcyk7XG5cbiAgY29uc3Qgc3ZnID0gKHRoaXMuZG9tRWxlbWVudC5uYW1lc3BhY2VVUkkgPT09IFNWR19OQU1FU1BBQ0VfVVJJKSwgLy8vXG4gICAgICAgIG5hbWVzID0gT2JqZWN0LmtleXMocHJvcGVydGllcyk7ICAvLy9cblxuICBuYW1lcy5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wZXJ0aWVzW25hbWVdO1xuXG4gICAgaWYgKGZhbHNlKSB7XG4gICAgICAvLy9cbiAgICB9IGVsc2UgaWYgKGlzSGFuZGxlck5hbWUobmFtZSkpIHtcbiAgICAgIGFkZEhhbmRsZXIodGhpcywgbmFtZSwgdmFsdWUpO1xuICAgIH0gZWxzZSBpZiAoaXNBdHRyaWJ1dGVOYW1lKG5hbWUsIHN2ZykpIHtcbiAgICAgIGFkZEF0dHJpYnV0ZSh0aGlzLCBuYW1lLCB2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghdGhpcy5oYXNPd25Qcm9wZXJ0eShcInByb3BlcnRpZXNcIikpIHtcbiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHt9O1xuXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywge1xuICAgICAgICAgIHByb3BlcnRpZXNcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucHJvcGVydGllc1tuYW1lXSA9IHZhbHVlO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgY29udGV4dCA9IHt9O1xuXG4gIGNoaWxkRWxlbWVudHMuZm9yRWFjaCgoY2hpbGRFbGVtZW50KSA9PiB7XG4gICAgdXBkYXRlQ29udGV4dChjaGlsZEVsZW1lbnQsIGNvbnRleHQpO1xuXG4gICAgY2hpbGRFbGVtZW50LmFkZFRvKHRoaXMpO1xuICB9KTtcblxuICBPYmplY3QuYXNzaWduKHRoaXMsIHtcbiAgICBjb250ZXh0XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJvcGVydGllcygpIHtcbiAgcmV0dXJuIHRoaXMucHJvcGVydGllcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbnRleHQoKSB7XG4gIHJldHVybiB0aGlzLmNvbnRleHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NpZ25Db250ZXh0KG5hbWVzLCB0aGVuRGVsZXRlKSB7XG4gIGNvbnN0IGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG5cbiAgaWYgKGFyZ3VtZW50c0xlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IGZpcnN0QXJndW1lbnQgPSBmaXJzdChhcmd1bWVudHMpO1xuXG4gICAgaWYgKHR5cGVvZiBmaXJzdEFyZ3VtZW50ID09PSBcImJvb2xlYW5cIikge1xuICAgICAgbmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLmNvbnRleHQpO1xuXG4gICAgICB0aGVuRGVsZXRlID0gZmlyc3RBcmd1bWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhlbkRlbGV0ZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKGFyZ3VtZW50c0xlbmd0aCA9PT0gMCkge1xuICAgIG5hbWVzID0gT2JqZWN0LmtleXModGhpcy5jb250ZXh0KTtcblxuICAgIHRoZW5EZWxldGUgPSB0cnVlO1xuICB9XG5cbiAgbmFtZXMuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jb250ZXh0W25hbWVdLFxuICAgICAgICAgIHByb3BlcnR5TmFtZSA9IG5hbWUsICAvLy9cbiAgICAgICAgICBkZXNjcmlwdG9yID0ge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgICAgfTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IpO1xuXG4gICAgaWYgKHRoZW5EZWxldGUpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmNvbnRleHRbbmFtZV07XG4gICAgfVxuICB9LCBbXSk7XG59XG5cbmZ1bmN0aW9uIGNoaWxkRWxlbWVudHNGcm9tRWxlbWVudEFuZFByb3BlcnRpZXMoZWxlbWVudCwgcHJvcGVydGllcykge1xuICBsZXQgY2hpbGRFbGVtZW50cyA9IG51bGw7XG5cbiAgaWYgKHR5cGVvZiBlbGVtZW50LmNoaWxkRWxlbWVudHMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGNoaWxkRWxlbWVudHMgPSBlbGVtZW50LmNoaWxkRWxlbWVudHMocHJvcGVydGllcyk7XG5cbiAgICBjaGlsZEVsZW1lbnRzID0gZ3VhcmFudGVlKGNoaWxkRWxlbWVudHMpO1xuXG4gICAgY2hpbGRFbGVtZW50cyA9IHJlbW92ZUZhbHNleUVsZW1lbnRzKGNoaWxkRWxlbWVudHMpO1xuXG4gICAgY2hpbGRFbGVtZW50cyA9IHJlcGxhY2VTdHJpbmdzV2l0aFRleHRFbGVtZW50cyhjaGlsZEVsZW1lbnRzKTtcbiAgfVxuXG4gIHJldHVybiBjaGlsZEVsZW1lbnRzO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVDb250ZXh0KGNoaWxkRWxlbWVudCwgY29udGV4dCkge1xuICBjb25zdCBwYXJlbnRDb250ZXh0ID0gKHR5cGVvZiBjaGlsZEVsZW1lbnQucGFyZW50Q29udGV4dCA9PT0gXCJmdW5jdGlvblwiKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkRWxlbWVudC5wYXJlbnRDb250ZXh0KCkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkRWxlbWVudC5jb250ZXh0OyAvLy9cblxuICBPYmplY3QuYXNzaWduKGNvbnRleHQsIHBhcmVudENvbnRleHQpO1xuXG4gIGRlbGV0ZSBjaGlsZEVsZW1lbnQuY29udGV4dDtcbn1cblxuZnVuY3Rpb24gYWRkSGFuZGxlcihlbGVtZW50LCBuYW1lLCB2YWx1ZSkge1xuICBjb25zdCBldmVudFR5cGUgPSBuYW1lLnN1YnN0cigyKS50b0xvd2VyQ2FzZSgpLCAvLy9cbiAgICAgICAgaGFuZGxlciA9IHZhbHVlOyAgLy8vXG5cbiAgZWxlbWVudC5vbihldmVudFR5cGUsIGhhbmRsZXIpO1xufVxuXG5mdW5jdGlvbiBhZGRBdHRyaWJ1dGUoZWxlbWVudCwgbmFtZSwgdmFsdWUpIHtcbiAgaWYgKG5hbWUgPT09IFwiY2xhc3NOYW1lXCIpIHtcbiAgICBuYW1lID0gXCJjbGFzc1wiO1xuICB9XG5cbiAgaWYgKG5hbWUgPT09IFwiaHRtbEZvclwiKSB7XG4gICAgbmFtZSA9IFwiZm9yXCI7XG4gIH1cblxuICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiKSB7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHZhbHVlKTtcblxuICAgIGtleXMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBlbGVtZW50LmRvbUVsZW1lbnRbbmFtZV1ba2V5XSA9IHZhbHVlW2tleV07XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIikge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdmFsdWUgPSBuYW1lOyAvLy9cblxuICAgICAgZWxlbWVudC5hZGRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBlbGVtZW50LmFkZEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNIYW5kbGVyTmFtZShuYW1lKSB7XG4gIHJldHVybiBuYW1lLm1hdGNoKC9eb24vKTtcbn1cblxuZnVuY3Rpb24gaXNBdHRyaWJ1dGVOYW1lKG5hbWUsIHN2Zykge1xuICByZXR1cm4gc3ZnID8gaXNTVkdBdHRyaWJ1dGVOYW1lKG5hbWUpIDogaXNIVE1MQXR0cmlidXRlTmFtZShuYW1lKVxufVxuIl19