"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _object = require("../utilities/object");

var _array = require("../utilities/array");

var _constants = require("../constants");

var _name = require("../utilities/name");

var _elements = require("../utilities/elements");

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function applyProperties(properties, defaultProperties, ignoredProperties) {
  var _this = this;

  properties = Object.assign({}, properties); ///

  (0, _object.combine)(properties, defaultProperties);
  var childElements = childElementsFromElementAndProperties(this, properties) || properties.childElements; ///

  (0, _object.prune)(properties, ignoredProperties);
  var namespaceURI = this.domElement.namespaceURI,
      svg = namespaceURI === _constants.SVG_NAMESPACE_URI,
      names = Object.keys(properties); ///

  names.forEach(function (name) {
    var value = properties[name];

    if (false) {///
    } else if (isHandlerName(name)) {
      addHandler(_this, name, value);
      delete properties[name];
    } else if (isAttributeName(name, svg)) {
      addAttribute(_this, name, value);
      delete properties[name];
    } else {///
    }
  });
  var context = {};
  childElements.forEach(function (childElement) {
    updateContext(childElement, context);
    childElement.addTo(_this);
  });
  Object.assign(this, {
    properties: properties,
    context: context
  });
}

function getProperties() {
  return this.properties;
}

function getContext() {
  return this.context;
}

function assignContext(names, thenDelete) {
  var _this2 = this;

  var argumentsLength = arguments.length;

  if (argumentsLength === 1) {
    var firstArgument = (0, _array.first)(arguments);

    if (typeof firstArgument === "boolean") {
      names = Object.keys(this.context);
      thenDelete = firstArgument;
    } else {
      thenDelete = true;
    }
  }

  if (argumentsLength === 0) {
    names = Object.keys(this.context);
    thenDelete = true;
  }

  names.forEach(function (name) {
    var value = _this2.context[name],
        propertyName = name,
        ///
    descriptor = {
      value: value
    };
    Object.defineProperty(_this2, propertyName, descriptor);

    if (thenDelete) {
      delete _this2.context[name];
    }
  }, []);
}

var jsxMixins = {
  applyProperties: applyProperties,
  getProperties: getProperties,
  getContext: getContext,
  assignContext: assignContext
};
var _default = jsxMixins;
exports["default"] = _default;

function childElementsFromElementAndProperties(element, properties) {
  var childElements = null;

  if (typeof element.childElements === "function") {
    childElements = element.childElements.call(element, properties);
    childElements = (0, _array.guarantee)(childElements);
    childElements = (0, _elements.removeFalseyElements)(childElements);
    childElements = (0, _elements.replaceStringsWithTextElements)(childElements);
  }

  return childElements;
}

function updateContext(childElement, context) {
  var parentContext = typeof childElement.parentContext === "function" ? childElement.parentContext() : childElement.context; ///

  Object.assign(context, parentContext);
  delete childElement.context;
}

function addHandler(element, name, value) {
  var eventType = name.substr(2).toLowerCase(),
      ///
  handler = value; ///

  element.on(eventType, handler);
}

function addAttribute(element, name, value) {
  if (name === "className") {
    name = "class";
  }

  if (name === "htmlFor") {
    name = "for";
  }

  if (_typeof(value) === "object") {
    var keys = Object.keys(value);
    keys.forEach(function (key) {
      element.domElement[name][key] = value[key];
    });
  } else if (typeof value === "boolean") {
    if (value) {
      value = name; ///

      element.addAttribute(name, value);
    }
  } else {
    element.addAttribute(name, value);
  }
}

function isHandlerName(name) {
  return name.match(/^on/);
}

function isAttributeName(name, svg) {
  return svg ? (0, _name.isSVGAttributeName)(name) : (0, _name.isHTMLAttributeName)(name);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzeC5qcyJdLCJuYW1lcyI6WyJhcHBseVByb3BlcnRpZXMiLCJwcm9wZXJ0aWVzIiwiZGVmYXVsdFByb3BlcnRpZXMiLCJpZ25vcmVkUHJvcGVydGllcyIsIk9iamVjdCIsImFzc2lnbiIsImNoaWxkRWxlbWVudHMiLCJjaGlsZEVsZW1lbnRzRnJvbUVsZW1lbnRBbmRQcm9wZXJ0aWVzIiwibmFtZXNwYWNlVVJJIiwiZG9tRWxlbWVudCIsInN2ZyIsIlNWR19OQU1FU1BBQ0VfVVJJIiwibmFtZXMiLCJrZXlzIiwiZm9yRWFjaCIsIm5hbWUiLCJ2YWx1ZSIsImlzSGFuZGxlck5hbWUiLCJhZGRIYW5kbGVyIiwiaXNBdHRyaWJ1dGVOYW1lIiwiYWRkQXR0cmlidXRlIiwiY29udGV4dCIsImNoaWxkRWxlbWVudCIsInVwZGF0ZUNvbnRleHQiLCJhZGRUbyIsImdldFByb3BlcnRpZXMiLCJnZXRDb250ZXh0IiwiYXNzaWduQ29udGV4dCIsInRoZW5EZWxldGUiLCJhcmd1bWVudHNMZW5ndGgiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmaXJzdEFyZ3VtZW50IiwicHJvcGVydHlOYW1lIiwiZGVzY3JpcHRvciIsImRlZmluZVByb3BlcnR5IiwianN4TWl4aW5zIiwiZWxlbWVudCIsImNhbGwiLCJwYXJlbnRDb250ZXh0IiwiZXZlbnRUeXBlIiwic3Vic3RyIiwidG9Mb3dlckNhc2UiLCJoYW5kbGVyIiwib24iLCJrZXkiLCJtYXRjaCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLFNBQVNBLGVBQVQsQ0FBeUJDLFVBQXpCLEVBQXFDQyxpQkFBckMsRUFBd0RDLGlCQUF4RCxFQUEyRTtBQUFBOztBQUN6RUYsRUFBQUEsVUFBVSxHQUFHRyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCSixVQUFsQixDQUFiLENBRHlFLENBQzdCOztBQUU1Qyx1QkFBUUEsVUFBUixFQUFvQkMsaUJBQXBCO0FB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QUEyQkMsS0FBM0I7QUFDRDtBQUNGLEdBTk0sTUFNQTtBQUNMcUIsSUFBQUEsT0FBTyxDQUFDakIsWUFBUixDQUFxQkwsSUFBckIsRUFBMkJDLEtBQTNCO0FBQ0Q7QUFDRjs7QUFFRCxTQUFTQyxhQUFULENBQXVCRixJQUF2QixFQUE2QjtBQUMzQixTQUFPQSxJQUFJLENBQUMrQixLQUFMLENBQVcsS0FBWCxDQUFQO0FBQ0Q7O0FBRUQsU0FBUzNCLGVBQVQsQ0FBeUJKLElBQXpCLEVBQStCTCxHQUEvQixFQUFvQztBQUNsQyxTQUFPQSxHQUFHLEdBQUcsOEJBQW1CSyxJQUFuQixDQUFILEdBQThCLCtCQUFvQkEsSUFBcEIsQ0FBeEM7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBjb21iaW5lLCBwcnVuZSB9IGZyb20gXCIuLi91dGlsaXRpZXMvb2JqZWN0XCI7XG5pbXBvcnQgeyBmaXJzdCwgZ3VhcmFudGVlIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9hcnJheVwiO1xuaW1wb3J0IHsgU1ZHX05BTUVTUEFDRV9VUkkgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBpc0hUTUxBdHRyaWJ1dGVOYW1lLCBpc1NWR0F0dHJpYnV0ZU5hbWUgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL25hbWVcIjtcbmltcG9ydCB7IHJlbW92ZUZhbHNleUVsZW1lbnRzLCByZXBsYWNlU3RyaW5nc1dpdGhUZXh0RWxlbWVudHMgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL2VsZW1lbnRzXCI7XG5cbmZ1bmN0aW9uIGFwcGx5UHJvcGVydGllcyhwcm9wZXJ0aWVzLCBkZWZhdWx0UHJvcGVydGllcywgaWdub3JlZFByb3BlcnRpZXMpIHtcbiAgcHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oe30sIHByb3BlcnRpZXMpOyAvLy9cblxuICBjb21iaW5lKHByb3BlcnRpZXMsIGRlZmF1bHRQcm9wZXJ0aWVzKTtcblxuICBjb25zdCBjaGlsZEVsZW1lbnRzID0gY2hpbGRFbGVtZW50c0Zyb21FbGVtZW50QW5kUHJvcGVydGllcyh0aGlzLCBwcm9wZXJ0aWVzKSB8fCBwcm9wZXJ0aWVzLmNoaWxkRWxlbWVudHM7ICAvLy9cblxuICBwcnVuZShwcm9wZXJ0aWVzLCBpZ25vcmVkUHJvcGVydGllcyk7XG5cbiAgY29uc3QgeyBuYW1lc3BhY2VVUkkgfSA9IHRoaXMuZG9tRWxlbWVudCxcbiAgICAgICAgc3ZnID0gKG5hbWVzcGFjZVVSSSA9PT0gU1ZHX05BTUVTUEFDRV9VUkkpLCAvLy9cbiAgICAgICAgbmFtZXMgPSBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKTsgIC8vL1xuXG4gIG5hbWVzLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IHByb3BlcnRpZXNbbmFtZV07XG5cbiAgICBpZiAoZmFsc2UpIHtcbiAgICAgIC8vL1xuICAgIH0gZWxzZSBpZiAoaXNIYW5kbGVyTmFtZShuYW1lKSkge1xuICAgICAgYWRkSGFuZGxlcih0aGlzLCBuYW1lLCB2YWx1ZSk7XG5cbiAgICAgIGRlbGV0ZSBwcm9wZXJ0aWVzW25hbWVdO1xuICAgIH0gZWxzZSBpZiAoaXNBdHRyaWJ1dGVOYW1lKG5hbWUsIHN2ZykpIHtcbiAgICAgIGFkZEF0dHJpYnV0ZSh0aGlzLCBuYW1lLCB2YWx1ZSk7XG5cbiAgICAgIGRlbGV0ZSBwcm9wZXJ0aWVzW25hbWVdO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLy9cbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IGNvbnRleHQgPSB7fTtcblxuICBjaGlsZEVsZW1lbnRzLmZvckVhY2goKGNoaWxkRWxlbWVudCkgPT4ge1xuICAgIHVwZGF0ZUNvbnRleHQoY2hpbGRFbGVtZW50LCBjb250ZXh0KTtcblxuICAgIGNoaWxkRWxlbWVudC5hZGRUbyh0aGlzKTtcbiAgfSk7XG5cbiAgT2JqZWN0LmFzc2lnbih0aGlzLCB7XG4gICAgcHJvcGVydGllcyxcbiAgICBjb250ZXh0XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRQcm9wZXJ0aWVzKCkge1xuICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzO1xufVxuXG5mdW5jdGlvbiBnZXRDb250ZXh0KCkge1xuICByZXR1cm4gdGhpcy5jb250ZXh0O1xufVxuXG5mdW5jdGlvbiBhc3NpZ25Db250ZXh0KG5hbWVzLCB0aGVuRGVsZXRlKSB7XG4gIGNvbnN0IGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG5cbiAgaWYgKGFyZ3VtZW50c0xlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IGZpcnN0QXJndW1lbnQgPSBmaXJzdChhcmd1bWVudHMpO1xuXG4gICAgaWYgKHR5cGVvZiBmaXJzdEFyZ3VtZW50ID09PSBcImJvb2xlYW5cIikge1xuICAgICAgbmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLmNvbnRleHQpO1xuXG4gICAgICB0aGVuRGVsZXRlID0gZmlyc3RBcmd1bWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhlbkRlbGV0ZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKGFyZ3VtZW50c0xlbmd0aCA9PT0gMCkge1xuICAgIG5hbWVzID0gT2JqZWN0LmtleXModGhpcy5jb250ZXh0KTtcblxuICAgIHRoZW5EZWxldGUgPSB0cnVlO1xuICB9XG5cbiAgbmFtZXMuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jb250ZXh0W25hbWVdLFxuICAgICAgICAgIHByb3BlcnR5TmFtZSA9IG5hbWUsICAvLy9cbiAgICAgICAgICBkZXNjcmlwdG9yID0ge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgICAgfTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IpO1xuXG4gICAgaWYgKHRoZW5EZWxldGUpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmNvbnRleHRbbmFtZV07XG4gICAgfVxuICB9LCBbXSk7XG59XG5cbmNvbnN0IGpzeE1peGlucyA9IHtcbiAgYXBwbHlQcm9wZXJ0aWVzLFxuICBnZXRQcm9wZXJ0aWVzLFxuICBnZXRDb250ZXh0LFxuICBhc3NpZ25Db250ZXh0XG59O1xuXG5leHBvcnQgZGVmYXVsdCBqc3hNaXhpbnM7XG5cbmZ1bmN0aW9uIGNoaWxkRWxlbWVudHNGcm9tRWxlbWVudEFuZFByb3BlcnRpZXMoZWxlbWVudCwgcHJvcGVydGllcykge1xuICBsZXQgY2hpbGRFbGVtZW50cyA9IG51bGw7XG5cbiAgaWYgKHR5cGVvZiBlbGVtZW50LmNoaWxkRWxlbWVudHMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGNoaWxkRWxlbWVudHMgPSBlbGVtZW50LmNoaWxkRWxlbWVudHMuY2FsbChlbGVtZW50LCBwcm9wZXJ0aWVzKTtcblxuICAgIGNoaWxkRWxlbWVudHMgPSBndWFyYW50ZWUoY2hpbGRFbGVtZW50cyk7XG5cbiAgICBjaGlsZEVsZW1lbnRzID0gcmVtb3ZlRmFsc2V5RWxlbWVudHMoY2hpbGRFbGVtZW50cyk7XG5cbiAgICBjaGlsZEVsZW1lbnRzID0gcmVwbGFjZVN0cmluZ3NXaXRoVGV4dEVsZW1lbnRzKGNoaWxkRWxlbWVudHMpO1xuICB9XG5cbiAgcmV0dXJuIGNoaWxkRWxlbWVudHM7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUNvbnRleHQoY2hpbGRFbGVtZW50LCBjb250ZXh0KSB7XG4gIGNvbnN0IHBhcmVudENvbnRleHQgPSAodHlwZW9mIGNoaWxkRWxlbWVudC5wYXJlbnRDb250ZXh0ID09PSBcImZ1bmN0aW9uXCIpID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRFbGVtZW50LnBhcmVudENvbnRleHQoKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRFbGVtZW50LmNvbnRleHQ7IC8vL1xuXG4gIE9iamVjdC5hc3NpZ24oY29udGV4dCwgcGFyZW50Q29udGV4dCk7XG5cbiAgZGVsZXRlIGNoaWxkRWxlbWVudC5jb250ZXh0O1xufVxuXG5mdW5jdGlvbiBhZGRIYW5kbGVyKGVsZW1lbnQsIG5hbWUsIHZhbHVlKSB7XG4gIGNvbnN0IGV2ZW50VHlwZSA9IG5hbWUuc3Vic3RyKDIpLnRvTG93ZXJDYXNlKCksIC8vL1xuICAgICAgICBoYW5kbGVyID0gdmFsdWU7ICAvLy9cblxuICBlbGVtZW50Lm9uKGV2ZW50VHlwZSwgaGFuZGxlcik7XG59XG5cbmZ1bmN0aW9uIGFkZEF0dHJpYnV0ZShlbGVtZW50LCBuYW1lLCB2YWx1ZSkge1xuICBpZiAobmFtZSA9PT0gXCJjbGFzc05hbWVcIikge1xuICAgIG5hbWUgPSBcImNsYXNzXCI7XG4gIH1cblxuICBpZiAobmFtZSA9PT0gXCJodG1sRm9yXCIpIHtcbiAgICBuYW1lID0gXCJmb3JcIjtcbiAgfVxuXG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIpIHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpO1xuXG4gICAga2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGVsZW1lbnQuZG9tRWxlbWVudFtuYW1lXVtrZXldID0gdmFsdWVba2V5XTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB2YWx1ZSA9IG5hbWU7IC8vL1xuXG4gICAgICBlbGVtZW50LmFkZEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGVsZW1lbnQuYWRkQXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc0hhbmRsZXJOYW1lKG5hbWUpIHtcbiAgcmV0dXJuIG5hbWUubWF0Y2goL15vbi8pO1xufVxuXG5mdW5jdGlvbiBpc0F0dHJpYnV0ZU5hbWUobmFtZSwgc3ZnKSB7XG4gIHJldHVybiBzdmcgPyBpc1NWR0F0dHJpYnV0ZU5hbWUobmFtZSkgOiBpc0hUTUxBdHRyaWJ1dGVOYW1lKG5hbWUpXG59XG4iXX0=